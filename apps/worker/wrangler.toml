name = "chatkin-os-worker"
main = "src/index.ts"
compatibility_date = "2024-11-22"
compatibility_flags = ["nodejs_compat"]

[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1

# Production routes - applies to default deployment
routes = [
  { pattern = "chatkin.ai/api/health", zone_name = "chatkin.ai" },
  { pattern = "chatkin.ai/api/ai/*", zone_name = "chatkin.ai" },
  { pattern = "chatkin.ai/api/upload", zone_name = "chatkin.ai" },
  { pattern = "chatkin.ai/api/save-to-library", zone_name = "chatkin.ai" },
  { pattern = "chatkin.ai/api/delete-file", zone_name = "chatkin.ai" },
  { pattern = "chatkin.ai/api/send-notification", zone_name = "chatkin.ai" },
  { pattern = "chatkin.ai/api/generate-assessment-report", zone_name = "chatkin.ai" },
  { pattern = "chatkin.ai/api/generate-onboarding", zone_name = "chatkin.ai" },
  { pattern = "chatkin.ai/api/temp-files/*", zone_name = "chatkin.ai" },
  { pattern = "chatkin.ai/api/files/*", zone_name = "chatkin.ai" },
  { pattern = "chatkin.ai/img/*", zone_name = "chatkin.ai" }
]

[triggers]
crons = ["0 * * * *"]  # Run every hour

[vars]
PUBLIC_WORKER_URL = "https://chatkin.ai"
INTERNAL_WORKER_URL = "https://chatkin-os-worker.andrewkylim.workers.dev"

[env.production]
name = "chatkin-os-worker"

[env.production.vars]
PUBLIC_WORKER_URL = "https://chatkin.ai"
INTERNAL_WORKER_URL = "https://chatkin-os-worker.andrewkylim.workers.dev"

[[env.production.r2_buckets]]
binding = "CHATKIN_BUCKET"
bucket_name = "chatkin-files"

[[env.production.r2_buckets]]
binding = "CHATKIN_TEMP_BUCKET"
bucket_name = "chatkin-files-temp"

[[r2_buckets]]
binding = "CHATKIN_BUCKET"
bucket_name = "chatkin-files"
preview_bucket_name = "chatkin-files-dev"

[[r2_buckets]]
binding = "CHATKIN_TEMP_BUCKET"
bucket_name = "chatkin-files-temp"
preview_bucket_name = "chatkin-files-temp-dev"

# Environment variables (set via wrangler secret put)
# ANTHROPIC_API_KEY
# SUPABASE_URL
# SUPABASE_ANON_KEY
# SUPABASE_SERVICE_ROLE_KEY (for cron jobs)
# RESEND_API_KEY
# SENTRY_DSN (optional)
